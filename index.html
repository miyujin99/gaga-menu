<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Candidate Profile Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicon -->
<link rel="icon" type="image/png" href="./assets/favicon.png?v=1">
<link rel="shortcut icon" href="./assets/favicon.png?v=1">

  <!-- PDF export library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    :root {
      --ashley-orange: #f78e2f;
      --ashley-orange-dark: #d86f12;
      --bg-light: #f3f4f6;
      --text-main: #111827;
      --border-soft: #e5e7eb;
      --blue-soft: #e0ecff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 20px 20px 22px;
      margin-bottom: 18px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }

    /* ========== HEADER ========== */

    .header-main {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .header-logo {
      height: 40px;
      width: auto;
      object-fit: contain;
    }

    .title {
      font-size: 22px;
      font-weight: 800;
      color: var(--ashley-orange-dark);
      letter-spacing: 0.02em;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #fff7ed;
      border: 1px solid #fed7aa;
      font-size: 11px;
      font-weight: 600;
      color: #9a3412;
      gap: 4px;
      white-space: nowrap;
    }

    .tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--ashley-orange);
    }

    .info-badge {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }

    /* ========== FORM SECTIONS ========== */

    .section-block {
      border-radius: 12px;
      padding: 14px 14px 10px;
      margin-bottom: 14px;
      background: linear-gradient(
          90deg,
          rgba(247, 142, 47, 0.09),
          rgba(59, 130, 246, 0.02)
        ),
        #ffffff;
      border-left: 4px solid var(--ashley-orange);
    }

    .section-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    h2.section-title {
      font-size: 15px;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #111827;
    }

    h2.section-title span.section-badge {
      font-size: 11px;
      font-weight: 800;
      text-transform: uppercase;
      color: #fb923c;
      background: #fff7ed;
      border-radius: 999px;
      padding: 2px 9px;
      border: 1px solid #fed7aa;
    }

    .section-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      white-space: nowrap;
    }

    .section-desc {
      font-size: 12px;
      color: #6b7280;
      margin: 0 0 10px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 16px;
    }

    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    .field {
      margin-bottom: 8px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .field-label .required {
      color: #dc2626;
    }

    .field-help {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 3px;
    }

    .field-error {
      font-size: 11px;
      color: #b91c1c;
      margin-top: 3px;
    }

    input[type="text"],
    input[type="email"],
    select,
    textarea {
      width: 100%;
      font-size: 13px;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background-color 0.15s;
      background: #f9fafb;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--ashley-orange);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(247, 142, 47, 0.15);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.4;
    }

	.pill-note {
	  display: inline-flex;
	  align-items: center;
	  gap: 6px;
	  font-size: 11px;
	  padding: 4px 10px;
	  border-radius: 999px;
	
	  background: #fff7ed;        /* cam nh·∫°t */
	  color: #9a3412;             /* text cam ƒë·∫≠m, d·ªÖ ƒë·ªçc */
	
	  border: 1px solid #fed7aa;  /* cam ƒë·∫≠m h∆°n n·ªÅn */
	  margin-bottom: 8px;
	}

    .preference-wrapper {
      border-radius: 10px;
      border: 1px dashed #e5e7eb;
      padding: 10px 10px 6px;
      margin-bottom: 8px;
      background: #f9fafb;
    }

    .preference-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .pref-title {
      font-size: 13px;
      font-weight: 700;
      color: #111827;
    }

    .pref-tag {
      font-size: 11px;
      color: #9ca3af;
    }

    .pref-dept-label {
      font-size: 11px;
      color: #4b5563;
      margin-top: 4px;
    }

    .checkbox-row,
    .radio-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 13px;
    }

    .checkbox-item,
    .radio-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkbox-item input,
    .radio-item input {
      margin: 0;
    }

    .consent-line {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
      align-items: flex-start;
      font-size: 12px;
      color: #374151;
    }

    .consent-line input {
      margin-top: 3px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.15s, box-shadow 0.15s, transform 0.05s;
    }

    .btn-primary {
      background: linear-gradient(
        135deg,
        var(--ashley-orange),
        var(--ashley-orange-dark)
      );
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(248, 153, 60, 0.35);
    }

    .btn-primary:hover {
      background: linear-gradient(
        135deg,
        var(--ashley-orange-dark),
        #b45309
      );
      box-shadow: 0 6px 16px rgba(248, 153, 60, 0.45);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

/* Soft Ashley Orange buttons (Success Modal download) */
.btn-orange-soft {
  background: #fff7ed;            /* cam nh·∫°t */
  color: #9a3412;                 /* cam ƒë·∫≠m ch·ªØ */
  border: 1px solid #fed7aa;
}

.btn-orange-soft:hover {
  background: #ffedd5;
  border-color: #fdba74;
}

.btn-orange-soft:active {
  background: #fed7aa;
}

    .btn-icon {
      font-size: 16px;
      line-height: 1;
    }

    .success-msg {
      font-size: 12px;
      color: #15803d;
      margin-top: 8px;
    }

    .json-output {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 10px;
      padding: 10px 12px;
      overflow: auto;
      max-height: 260px;
      border: 1px solid #0f172a;
    }

    .json-output strong {
      color: #facc15;
    }

    .has-error {
      border-color: #f97373 !important;
      background: #fef2f2 !important;
    }

    hr.soft {
      border: none;
      border-bottom: 1px dashed #e5e7eb;
      margin: 16px 0;
    }

    /* ========== MODAL & PROFILE (PDF) ========== */

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal.show {
      display: flex;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
    }

    .modal-dialog {
      position: relative;
      background: #f3f4f6;
      border-radius: 16px;
      max-width: 900px;
      width: 96%;
      max-height: 92vh;
      overflow: auto;
      padding: 18px 20px 20px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.65);
    }

    .modal-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 700;
    }

    .modal-close {
      border: none;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
      line-height: 1;
      color: #6b7280;
    }

    /* PDF wrapper roughly A4 width */
    #pdfWrapper {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px 18px 18px;
      border: 1px solid #e5e7eb;
      width: 800px;
      max-width: 100%;
      margin: 0 auto;
    }

    .pdf-header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 14px 18px;
      border-radius: 10px;
      margin-bottom: 12px;
      background: linear-gradient(
        90deg,
        #f97316,
        #ea580c
      );
      color: #fefce8;
    }

.pdf-header-left {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px; /* base */
}

.pdf-header-title {
  font-weight: 700;
  font-size: 15px;
}

.pdf-header-subtitle {
  font-size: 13px;
  opacity: 0.9;
}


    .pdf-logo-box {
      width: 70px;
      height: 26px;
      border-radius: 999px;
      background: #fef3c7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      color: #b45309;
    }

    .pdf-header-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      font-size: 11px;
    }

    .pdf-tag {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(254, 243, 199, 0.9);
      background: rgba(254, 243, 199, 0.18);
      font-weight: 600;
    }

    #candidateProfileCard {
      border-radius: 10px;
      border: 1px solid #dbeafe;
      padding: 12px 12px 14px;
      font-size: 13px;
      background: #f9fafb;
    }

    .profile-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 10px;
    }

    .profile-col {
      flex: 1 1 260px;
    }

    .profile-col-full {
      flex: 1 1 100%;
    }

    .box {
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 10px 10px 8px;
      height: 100%;
    }

    .box-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-weight: 700;
      color: #1e3a8a;
    }

    .box-header span.icon {
      font-size: 14px;
    }

    .box-subtitle {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .dl-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 12px;
      font-size: 12px;
    }

    .dl-grid dt {
      color: #6b7280;
    }

    .dl-grid dd {
      margin: 0;
      color: #111827;
    }

    .pill-small {
      font-size: 11px;
      border-radius: 999px;
      padding: 2px 7px;
      display: inline-block;
    }

    .pill-blue {
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .pill-yellow {
      background: #fef9c3;
      color: #854d0e;
      border: 1px solid #facc15;
    }

    .profile-sbi {
      font-size: 12px;
      margin-top: 4px;
    }

.profile-sbi dt {
  font-weight: 600;
  color: #854d0e;
  margin-top: 8px;
}

    .profile-sbi dd {
      margin: 0 0 4px;
    }

    .dept-tag {
      font-size: 11px;
      color: #6b7280;
      font-style: italic;
    }

    /* Basic Info ‚Äì 3-column layout */
    .dl-basic {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px 18px;
      font-size: 12px;
    }
	/* ===== Photo upload (Form) ===== */
.photo-upload-row{
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}

.photo-preview{
  width:56px;
  height:56px;
  border-radius:12px;
  border:1px solid #e5e7eb;
  background:#fff;
  object-fit:cover;
  display:block;
}

.photo-hint{
  font-size:11px;
  color:#6b7280;
  margin-top:4px;
}

/* ===== PDF Basic Info with Photo (right side) ===== */
.basic-info-flex{
  display:flex;
  align-items:stretch;
  gap:14px;
}

.basic-info-left{
  flex: 1 1 auto;
  min-width:0;
}

.basic-info-photo{
  flex: 0 0 120px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== PDF Photo (crop wrapper) ===== */
.pdf-photo{
  width:108px;
  height:108px;
  border-radius:14px;
  border:1px solid #e5e7eb;
  background:#f9fafb;
  overflow:hidden;
  position:relative;
}

/* Crop ki·ªÉu ‚Äúcover‚Äù nh∆∞ng ·ªïn ƒë·ªãnh h∆°n html2canvas */
.pdf-photo img{
  position:absolute;
  top:50%;
  left:50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;

  /* quan tr·ªçng: ƒë·ªÉ ·∫£nh kh√¥ng b·ªã b√®, ∆∞u ti√™n cover */
  object-fit: cover;

  /* tr√°nh baseline gap */
  display:block;
}



.pdf-photo-empty{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  width:108px;
  height:108px;
  border-radius:14px;
  border:1px dashed #d1d5db;
  background:#ffffff;
  color:#9ca3af;
  font-size:11px;
  gap:6px;
}


    .dl-basic .bi-item {
      min-width: 0;
    }

    .dl-basic dt {
      font-size: 11px;
      font-weight: 700;
      color: #f97316;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 2px;
    }

    .dl-basic dd {
      margin: 0;
      font-size: 13px;
      font-weight: 600;
      color: #111827;
    }

    @media (max-width: 768px) {
      .dl-basic {
        grid-template-columns: 1fr;
      }
    }

    /* Success modal */
    .success-body {
      font-size: 13px;
      color: #374151;
      line-height: 1.5;
    }

    .success-body a {
      color: var(--ashley-orange-dark);
      text-decoration: none;
      font-weight: 600;
    }

    .success-body a:hover {
      text-decoration: underline;
    }

    /* Light Ashley Orange Header ‚Äì compact version (desktop base) */
	.header-subtitle{
  font-size: 13px;
  color: #5c4a3a;
  max-width: 100%;
  line-height: 1.4;
  margin-top: 2px;
}

    .header-orange {
      background: linear-gradient(
          90deg,
          rgba(247, 142, 47, 0.14),
          rgba(247, 142, 47, 0.05)
        ),
        #fff7ed;
      padding: 24px 28px;
      border-radius: 16px;
      border: 1px solid #f5d8bd;
    }

    .header-logo-big {
      width: 200px;
      height: auto;
      margin-bottom: 6px;
      display: block;
    }
	
	.header-title-row{
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
}

	
    .page-title {
      font-size: 24px;
      font-weight: 800;
      color: #1a1f50;
      margin: 0;
    }

    .program-title {
      font-size: 14px;
      font-weight: 700;
      color: #9a4a0b;
      margin-top: -2px;
    }

    .info-badge {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: #876a54;
      margin-top: 4px;
    }

    /* ========== MOBILE TWEAKS (PHONE) ========== */
    @media (max-width: 600px) {
      .page {
        padding: 0 8px;
        margin: 12px auto 24px;
      }

      .card {
        padding: 14px 12px 16px;
        margin-bottom: 12px;
        border-radius: 12px;
      }

      .section-block {
        padding: 10px 10px 8px;
        margin-bottom: 10px;
      }

      .field {
        margin-bottom: 6px;
      }

      .header-orange {
        padding: 18px 14px;
        border-radius: 0 0 16px 16px;
      }

      .header-logo-big {
        width: 64px;
        margin-bottom: 4px;
      }

      .page-title {
        font-size: 22px;
      }

      .program-title {
        font-size: 13px;
      }

      .header-subtitle {
        font-size: 12px;
      }

      .info-badge {
        font-size: 10px;
        letter-spacing: 0.02em;
      }

      input[type="text"],
      input[type="email"],
      select,
      textarea {
        font-size: 13px;
        padding: 9px 10px;
      }

      .btn-row {
        flex-direction: column;
        align-items: stretch;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      #btnReset {
        order: 2; /* Generate n·∫±m tr√™n, Clear n·∫±m d∆∞·ªõi */
      }

      .checkbox-row,
      .radio-row {
        gap: 6px 12px;
        font-size: 13px;
      }

      .checkbox-item input,
      .radio-item input {
        width: 18px;
        height: 18px;
      }

      .modal-dialog {
        padding: 14px 14px 16px;
      }
    }
	/* ===== Step 2 MS Form Link ===== */
	.msform-link {
	  display: inline-flex;
	  align-items: center;
	  gap: 6px;
	  padding: 8px 14px;
	  border-radius: 999px;
	  font-size: 12.5px;
	  font-weight: 700;
	  text-decoration: none;
	  border: 1px solid #fed7aa;
	  transition: all 0.15s ease;
	}
	
	/* ===== Step 2 Highlight Pulse ===== */
@keyframes step2Pulse {
  0%   { box-shadow: 0 0 0 0 rgba(247,142,47,0.55); transform: translateY(0); }
  60%  { box-shadow: 0 0 0 10px rgba(247,142,47,0); transform: translateY(-1px); }
  100% { box-shadow: 0 0 0 0 rgba(247,142,47,0); transform: translateY(0); }
}

.msform-link.pulse {
  animation: step2Pulse 1.1s ease-out 100; /* pulse 100 l·∫ßn */
}

/* lu√¥n gi·ªØ vi·ªÅn s√°ng khi unlocked (k·ªÉ c·∫£ sau khi pulse xong) */
.msform-link.unlocked {
  background: linear-gradient(135deg, #fb923c, #f97316);
  color: #ffffff;
  border-color: transparent;
  box-shadow:
    0 6px 18px rgba(251,146,60,0.45),
    0 0 0 2px rgba(251,146,60,0.25);
}

	
	/* Locked state */
.msform-link.locked {
  background: #fef3c7;
  color: #9a3412;
  opacity: 0.6;
  pointer-events: none;
  cursor: not-allowed;
  animation: none !important; /* ‚úÖ locked l√† kh√¥ng nh√°y */
}

	/* Unlocked state */	
	.msform-link.unlocked:hover {
	  transform: translateY(-1px);
	  box-shadow: 0 6px 16px rgba(248,153,60,0.45);
	}
	/* ===== Micro Toast ===== */
	.toast {
	  position: fixed;
	  left: 50%;
	  bottom: 18px;
	  transform: translateX(-50%);
	  z-index: 1200;
	  display: none;
	}
	
	.toast.show {
	  display: block;
	  animation: toastIn 0.18s ease-out;
	}
	
	@keyframes toastIn {
	  from { opacity: 0; transform: translateX(-50%) translateY(6px); }
	  to   { opacity: 1; transform: translateX(-50%) translateY(0); }
	}
	
	.toast-inner {
	  display: inline-flex;
	  align-items: center;
	  gap: 10px;
	  background: #ffffff;
	  border: 1px solid #bbf7d0;
	  box-shadow: 0 10px 28px rgba(15,23,42,0.14);
	  border-radius: 999px;
	  padding: 10px 14px;
	  color: #166534;
	  font-size: 12.5px;
	  font-weight: 700;
	}
/* ===== Header Intro / Steps (cleaner layout) ===== */
.header-orange .header-main { gap: 12px; }

.intro-line{
  margin: 6px 0 2px;
  font-size: 13px;
  color: #5c4a3a;
  line-height: 1.5;
}

.steps-grid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 12px;
  margin-top: 8px;
}

.step-card{
  background: rgba(255,255,255,0.75);
  border: 1px solid #f5d8bd;
  border-radius: 14px;
  padding: 12px 12px 10px;
  box-shadow: 0 8px 18px rgba(15,23,42,0.05);
}

.step-top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
  margin-bottom:8px;
}

.step-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: .04em;
  text-transform: uppercase;
  border: 1px solid #fed7aa;
  background: #fff7ed;
  color: #9a3412;
  white-space: nowrap;
}

.step-chip{
  font-size: 11px;
  font-weight: 700;
  padding: 3px 9px;
  border-radius: 999px;
  border: 1px solid #bfdbfe;
  background: #eff6ff;
  color: #1d4ed8;
  white-space: nowrap;
}

.step-title{
  font-size: 13px;
  font-weight: 800;
  color: #1f2937;
  margin: 0 0 2px;
}

.step-sub{
  margin-bottom: 8px;
  font-size: 12px;
  color: #6b7280;
  line-height: 1.4;
}

.step-list{
  margin: 0;
  padding-left: 16px;
  font-size: 12px;
  color: #374151;
  line-height: 1.5;
}

.step-list li{ margin: 2px 0; }

.header-footnote{
  margin-top: 10px;
  font-size: 11px;
  color: #876a54;
  text-transform: uppercase;
  letter-spacing: .03em;
  font-weight: 700;
}

/* Mobile */
@media (max-width: 600px){
  .steps-grid{ grid-template-columns: 1fr; }
  .step-card{ padding: 10px 10px 8px; border-radius: 12px; }
  .intro-line{ font-size: 12px; }
}
/* ===== Inline Guideline (HR / Policy) ===== */
.guideline-note {
  margin-top: 6px;
  margin-bottom: 6px;
  padding: 8px 12px;
  font-size: 12px;
  line-height: 1.45;
  color: #1d4ed8;
  background: #ffffff;
  border-left: 3px solid #1d4ed8;
}

.guideline-note strong {
  font-weight: 700;
  color: #1f2937;
}

  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER -->
<div class="card header-orange">
  <div class="header-main">

    <div class="header-title-row">
      <div>
        <div class="page-title">Candidate Profile Builder</div>
        <div class="program-title">CVRO Talent Uplift Program 2026</div>
      </div>

      <img
        src="assets/logo.png"
        alt="Ashley Logo"
        class="header-logo-big"
        id="secretSampleLogo"
        style="cursor:pointer;"
        title=""
      />
    </div>

    <p class="intro-line">
      <strong>Welcome!</strong> You have been nominated by your Head of Department for the
      <strong>CVRO Talent Uplift Program</strong>. Participation is <strong>your choice</strong>.
      If you wish to move forward, please complete the two steps below.
    </p>

    <div class="steps-grid">
      <!-- STEP 1 -->
      <div class="step-card">
        <div class="step-top">
          <span class="step-badge">Step 1</span>
          <span class="step-chip">This page</span>
        </div>
        <div class="step-title">Build Your Candidate Profile</div>
        <div class="step-sub">Use this page to create your Candidate Profile by 
		sharing your career aspirations and development role preferences. 
		You will need to:</div>

        <ul class="step-list">
          <li>Complete all required fields</li>
          <li>Generate and download your profile in <strong>PDF</strong> and <strong>Excel</strong> format</li>
        </ul>
      </div>

      <!-- STEP 2 -->
      <div class="step-card">
        <div class="step-top">
          <span class="step-badge">Step 2</span>
          <span class="step-chip">Microsoft Forms</span>
        </div>
        <div class="step-title">Submit Your Application</div>
        <div class="step-sub">Upload the downloaded files to the MS Forms link below to complete your submission.</div>

        <div style="margin-top:10px;">
          <a
            id="msFormLink"
            href="https://forms.office.com/r/E7J5syLsjD"
            target="_blank"
            rel="noopener"
            class="msform-link locked"
            aria-disabled="true"
          >
            üîí Step 2 ‚Äì Open Microsoft Forms Application
          </a>
        </div>

        <div class="step-sub" style="margin-top:8px;">
          The form link will be available <strong>after</strong> you generate and download your Candidate Profile.
        </div>
      </div>
    </div>

    <div class="header-footnote">
      Please complete this page in English. Fields marked (*) are required.
    </div>

  </div>
</div>



    <!-- ========== FORM CARD ========== -->
    <form id="applicationForm" class="card" novalidate>
      <div id="successMessage" class="success-msg" style="display:none;">
        ‚úÖ Your profile passed validation. A Candidate Profile preview has been generated. Please review and confirm in the popup window.
      </div>

      <!-- SECTION 1 ¬∑ CANDIDATE INFO -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 1</span>
            Candidate Information
          </h2>
          <div class="section-chip">üë§ Who you are</div>
        </div>
        <p class="section-desc">
          Basic information used to identify you and link your profile to the Talent Uplift program database.
        </p>

        <div class="grid-2">
          <div class="field">
            <label class="field-label" for="fullName">
              Full Name <span class="required">*</span>
            </label>
            <input
              type="text"
              id="fullName"
              name="fullName"
              autocomplete="off"
              placeholder="e.g., Nguyen Van A"
            />
            <div id="err-fullName" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="employeeId">
              Employee ID (4 digits) <span class="required">*</span>
            </label>
            <input
              type="text"
              id="employeeId"
              name="employeeId"
              autocomplete="off"
              placeholder="e.g., 0123"
            />
            <div id="err-employeeId" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="workEmail">
              Work Email <span class="required">*</span>
            </label>
            <div class="field-help">
              Please enter your Ashley work email (@ashleyfurniture.com).
            </div>
            <input
              type="email"
              id="workEmail"
              name="workEmail"
              autocomplete="off"
              placeholder="e.g., firstname.lastname@ashleyfurniture.com"
            />
            <div id="err-workEmail" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="currentDept">
              Current Department <span class="required">*</span>
            </label>
            <div class="field-help">
             Please select your current department.
            </div>
            <select id="currentDept" name="currentDept">
              <option value="">-- Select department --</option>
            </select>
            <div id="err-currentDept" class="field-error"></div>
          </div>
        </div>

		<div class="field">
		  <label class="field-label" for="currentRole">
		    Current Role / Position <span class="required">*</span>
		  </label>
		  <div class="field-help">
		    Please select your current role / position. Options are filtered by your current department.
		  </div>
		  <select id="currentRole" name="currentRole">
		    <option value="">-- Select department first --</option>
		  </select>
		  <div id="err-currentRole" class="field-error"></div>
		</div>
		
		<div class="field">
  <label class="field-label" for="profilePhoto">
    Profile Photo (Optional)
  </label>

  <div class="field-help">
    Upload a clear headshot (JPG/PNG). This photo will appear in your PDF Candidate Profile.
  </div>

  <div class="photo-upload-row">
    <input
      type="file"
      id="profilePhoto"
      name="profilePhoto"
      accept="image/*"
    />
    <img id="photoPreview" class="photo-preview" alt="Photo preview" src="" style="display:none;" />
  </div>

  <div class="photo-hint">Recommended: square photo, under 2MB.</div>
  <div id="err-profilePhoto" class="field-error"></div>
</div>


      </section>

      <hr class="soft" />

      <!-- SECTION 2 ¬∑ DEVELOPMENT PREFERENCES -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 2</span>
            Development Role Preferences
          </h2>
          <div class="section-chip">üóÇÔ∏è Target roles</div>
        </div>
        <p class="section-desc">
          Please select up to two roles you are interested in as part of your development journey under the Talent Uplift program.
          At least one preference must be within your current department. </p>

        <div class="pill-note">
          <span>üí°</span>
          <span>Preference 1 is required. Preference 2 is optional but must be different.</span>
        </div>

<div class="guideline-note" style="margin-top:4px;margin-bottom:8px;">
  <span>
The roles shown here are prioritized and approved by CVRO Top Management to support talent development within CVRO.
Including these roles in the program does not affect employees currently in these positions.
Your selection is used to reflect your development direction and support your learning journey
  </span>
</div>



        <!-- PREFERENCE 1 -->
        <div class="preference-wrapper">
          <div class="preference-header">
            <div class="pref-title">Preference 1 ‚Äì Primary Role</div>
            <div class="pref-tag">Required</div>
          </div>

          <div class="field">
            <label class="field-label" for="pref1Role">
              Target Role (Preference 1) <span class="required">*</span>
            </label>
            <select id="pref1Role" name="pref1Role">
              <option value="">-- Select role --</option>
            </select>
            <div id="pref1DeptLabel" class="pref-dept-label">
              Department: <em>--</em>
            </div>
            <div id="err-pref1Role" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="pref1Reason">
              Reason for Preference 1 <span class="required">*</span>
            </label>
            <div class="field-help">
              Why are you interested in this role and how does it align with your development path?
            </div>
            <textarea
              id="pref1Reason"
              name="pref1Reason"
              minlength="30"
              placeholder="Please describe your motivation and how your strengths and aspirations fit this role. Please write at least 2‚Äì3 meaningful lines."
            ></textarea>
            <div id="err-pref1Reason" class="field-error"></div>
          </div>
        </div>

        <!-- PREFERENCE 2 -->
        <div class="preference-wrapper">
          <div class="preference-header">
            <div class="pref-title">Preference 2 ‚Äì Secondary Role</div>
            <div class="pref-tag">Optional</div>
          </div>

          <div class="field">
            <label class="field-label" for="pref2Role">
              Target Role (Preference 2)
            </label>
            <div class="field-help">
              Optional ‚Äì select only if you would like to be considered for a second role.
            </div>
            <select id="pref2Role" name="pref2Role">
              <option value="">-- No secondary preference --</option>
            </select>
            <div id="pref2DeptLabel" class="pref-dept-label">
              Department: <em>--</em>
            </div>
            <div id="err-pref2Role" class="field-error"></div>
          </div>

          <div class="field">
            <label class="field-label" for="pref2Reason">
              Reason for Preference 2
            </label>
            <div class="field-help">
              Required only if a secondary role is selected.
            </div>
            <textarea
              id="pref2Reason"
              name="pref2Reason"
              minlength="30"
              placeholder="Explain why this role is also a suitable direction for your development."
            ></textarea>
            <div id="err-pref2Reason" class="field-error"></div>
          </div>
        </div>

        <!-- CROSS-DEPT JUSTIFICATION -->
        <div id="crossDeptBlock" class="field" style="display:none;">
          <label class="field-label" for="crossJustification">
            Cross-Functional Development Rationale <span class="required">*</span>
          </label>
          <div class="field-help">
            This question appears because at least one of your preferences is in a different department from your current one.
          </div>
          <textarea
            id="crossJustification"
            name="crossJustification"
            placeholder="Describe your rationale for applying to a role in another department, including relevant experiences and how you plan to bridge any gaps."
          ></textarea>
          <div id="err-crossJustification" class="field-error"></div>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 3 ¬∑ ROLE-SPECIFIC (ALL MANAGERIAL) -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 3</span>
            Role-Specific Questions (Managerial)
          </h2>
          <div class="section-chip">üß≠ Leadership focus</div>
        </div>
        <p class="section-desc">
          All target roles in this round are managerial. Please describe your leadership approach and provide one example using the SBI (Situation‚ÄìBehavior‚ÄìImpact) format.
        </p>

        <div class="field">
          <label class="field-label" for="leadershipStyle">
            Future Leadership Style <span class="required">*</span>
          </label>
          <div class="field-help">
            How would you lead, motivate, and support your team in the target role?
          </div>
          <textarea
            id="leadershipStyle"
            name="leadershipStyle"
            minlength="30"
            placeholder="Share your view on how you would lead people in the future role."
          ></textarea>
          <div id="err-leadershipStyle" class="field-error"></div>
        </div>

        <div class="field">
          <label class="field-label">
            Example of Influencing or Motivating Others (SBI Format)
            <span class="required">*</span>
          </label>
          <div class="field-help">
            Please describe one situation where you influenced or motivated others, using 3 short parts below.
          </div>
          <div class="field">
            <label class="field-label" for="sbiSituation">
              Situation (S) <span class="required">*</span>
            </label>
            <textarea
              id="sbiSituation"
              name="sbiSituation"
              minlength="20"
              placeholder="What was happening? What was the context?"
            ></textarea>
            <div id="err-sbiSituation" class="field-error"></div>
          </div>
          <div class="field">
            <label class="field-label" for="sbiBehavior">
              Behavior (B) <span class="required">*</span>
            </label>
            <textarea
              id="sbiBehavior"
              name="sbiBehavior"
              minlength="20"
              placeholder="What did you do? What specific actions did you take?"
            ></textarea>
            <div id="err-sbiBehavior" class="field-error"></div>
          </div>
          <div class="field">
            <label class="field-label" for="sbiImpact">
              Impact (I) <span class="required">*</span>
            </label>
            <textarea
              id="sbiImpact"
              name="sbiImpact"
              minlength="20"
              placeholder="What changed as a result? What was the outcome for others, the team, or the business?"
            ></textarea>
            <div id="err-sbiImpact" class="field-error"></div>
          </div>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 4 ¬∑ CAREER ASPIRATION & MOBILITY -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 4</span>
            Career Aspiration & Mobility
          </h2>
          <div class="section-chip">‚ö° Direction & flexibility</div>
        </div>

        <div class="field">
          <label class="field-label" for="careerGoals">
            Short- to Mid-term Career Goals (1‚Äì3 years)
            <span class="required">*</span>
          </label>
          <textarea
            id="careerGoals"
            name="careerGoals"
            minlength="30"
            placeholder="What are your development goals for the next 1‚Äì3 years?. Share the directions you want to grow toward."
          ></textarea>
          <div id="err-careerGoals" class="field-error"></div>
        </div>

        <div class="field">
          <label class="field-label" for="motivation">
            Why Do You Want to Be Considered for These Role(s)?
            <span class="required">*</span>
          </label>
          <textarea
            id="motivation"
            name="motivation"
            minlength="30"
            placeholder="What motivates you to join the Talent Uplift Program and be considered for the Talent Pool? Explain your long-term aspiration, your motivation for applying, and how these selected role(s) fit your development path."
          ></textarea>
          <div id="err-motivation" class="field-error"></div>
        </div>

<div class="field" id="changeDeptWrap">
  <label class="field-label">
    Willingness to Change Department <span class="required">*</span>
  </label>
            <div class="field-help">
            Would you be open to moving to another department as part of a cross-functional opportunity or a future development pathway?
          </div>
  <div class="radio-row">
    <label class="radio-item">
      <input type="radio" name="changeDept" value="yes" />
      Yes
    </label>
    <label class="radio-item">
      <input type="radio" name="changeDept" value="maybe" />
      Maybe / Depends on role
    </label>
    <label class="radio-item">
      <input type="radio" name="changeDept" value="no" />
      No
    </label>
  </div>
  <div id="err-changeDept" class="field-error"></div>
</div>


      </section>

      <hr class="soft" />

      <!-- SECTION 5 ¬∑ OPTIONAL SELF-LEADERSHIP -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 5</span>
            Optional ‚Äì Self-leadership Reflection
          </h2>
          <div class="section-chip">üå± Ownership of growth</div>
        </div>
        <p class="section-desc">
          You may share an example where you took ownership of your own learning, performance, or development (optional but helpful).
        </p>

        <div class="field">
          <label class="field-label" for="selfLeadership">
            Example of Self-Leadership (Optional)
          </label>
          <textarea
            id="selfLeadership"
            name="selfLeadership"
            placeholder="Describe a recent moment where you took initiative for your own growth or performance."
          ></textarea>
        </div>
      </section>

      <hr class="soft" />

      <!-- SECTION 6 ¬∑ CONSENT -->
      <section class="section-block">
        <div class="section-header-row">
          <h2 class="section-title">
            <span class="section-badge">Section 6</span>
            Program Understanding & Consent
          </h2>
          <div class="section-chip">‚úÖ Confirmation</div>
        </div>

        <div class="field">
          <div class="consent-line">
            <input
              type="checkbox"
              id="consentDevelopment"
              name="consentDevelopment"
            />
            <label for="consentDevelopment">
              I understand that the Talent Uplift Program is designed to support my growth and readiness for future roles, rather than immediate promotion.
            </label>
          </div>
          <div class="consent-line">
            <input
              type="checkbox"
              id="consentSharing"
              name="consentSharing"
            />
            <label for="consentSharing">
              I understand that my profile and role preferences may be shared with relevant Department Heads and AHR to enable meaningful review and development support.
            </label>
          </div>
          <div class="consent-line">
            <input
              type="checkbox"
              id="consentAccuracy"
              name="consentAccuracy"
            />
            <label for="consentAccuracy">
              I confirm that the information shared in this profile reflects my current understanding and intentions.
            </label>
          </div>
          <div id="err-consents" class="field-error"></div>
        </div>
      </section>

      <!-- ACTIONS -->
      <div class="btn-row">
        <button type="reset" class="btn btn-secondary" id="btnReset">
          Clear
        </button>
        <button type="submit" class="btn btn-primary">
          <span class="btn-icon">üì§</span>
          <span>Generate Candidate Profile</span>
        </button>
      </div>  
    </form>

    <!-- ========== PROFILE MODAL ========== -->
    <div id="profileModal" class="modal">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog">
        <div class="modal-header-row">
          <div class="modal-title">Candidate Profile ‚Äì Preview</div>
          <button type="button" id="closeModalBtn" class="modal-close" aria-label="Close">
            √ó
          </button>
        </div>

        <!-- PDF CONTENT -->
        <div id="pdfWrapper">
          <div class="pdf-header-bar">
            <div class="pdf-header-left">
              <div class="pdf-logo-box">CVRO</div>
              <div>
				<div style="font-weight:700;font-size:15px;">
				  CANDIDATE PROFILE SUMMARY
				</div>
				<div style="font-size:13px;opacity:0.9;">
				  Talent Uplift Program 2026
				</div>
              </div>
            </div>
			<div class="pdf-header-right">
			  <div class="pdf-tag" id="pdfTagEmployeeId">ID: ‚Äî</div>
			</div>
          </div>

          <div id="candidateProfileCard">
            <!-- ROW 1 ¬∑ BASIC INFO (FULL WIDTH, 3 COLUMNS) -->
            <div class="profile-row">
              <div class="profile-col-full">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üë§</span>
                    <span>Basic Info</span>
                  </div>
                  <div class="basic-info-flex">
  <div class="basic-info-left">
    <dl class="dl-basic">
      <div class="bi-item">
        <dt>Full name</dt>
        <dd id="bi-name">‚Äî</dd>
      </div>
      <div class="bi-item">
        <dt>Department</dt>
        <dd id="bi-dept">‚Äî</dd>
      </div>
      <div class="bi-item">
        <dt>Current role</dt>
        <dd id="bi-role">‚Äî</dd>
      </div>
    </dl>
  </div>

  <div class="basic-info-photo">
    <!-- If has photo -->
<div id="bi-photo" class="pdf-photo" style="display:none;">
  <img id="bi-photo-img" alt="Profile photo" src="" />
</div>


    <!-- If no photo -->
    <div id="bi-photo-empty" class="pdf-photo-empty">
      <div style="font-size:18px;">üì∑</div>
      <div>No photo</div>
    </div>
  </div>
</div>

              </div>
            </div>

            <!-- ROW 2 ¬∑ DEVELOPMENT PREFERENCES (2 COLUMNS) -->
            <div class="profile-row">
              <!-- LEFT: ROLES -->
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üóÇÔ∏è</span>
                    <span>Development Preferences ‚Äì Roles</span>
                  </div>
                  <div class="box-subtitle">
                    At least one preference should be in the current department.
                  </div>
                  <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;">
                    <div>
                      <div class="pill-small pill-blue" style="margin-bottom:3px;">1st Preference</div>
                      <div id="pref1">‚Äî</div>
                    </div>
                    <div>
                      <div class="pill-small pill-blue" style="margin-bottom:3px;">2nd Preference</div>
                      <div id="pref2">‚Äî</div>
                      <div id="crossNotice" class="pill-small pill-yellow" style="margin-top:4px;display:none;">
                        Cross-dept
                      </div>
                    </div>
                  </div>
				<!-- Cross-department Development Rationale (Only show if cross-dept) -->
				<div id="pdfCrossJustWrap" style="display:none; margin-top:10px;">
				
				  <div style="font-size:12px;margin-bottom:8px;font-weight:700;color:#374151;">
				    Cross-Department Development Rationale
				  </div>
				
				  <div id="pdfCrossJustText"
				       style="font-size:12px;
				              border:1px solid #fdba74;
				              border-radius:8px;
				              padding:8px 10px;
				              color:#111827;
				              white-space:pre-wrap;">
				    ‚Äî
				  </div>
				</div>				
                </div>
              </div>

              <!-- RIGHT: REASONS -->
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üóÇÔ∏è</span>
                    <span>Development Preferences ‚Äì Reasons</span>
                  </div>
                  <div class="box-subtitle">
                    Brief summary of why the candidate chose these role(s).
                  </div>
                  <div style="font-size:12px;margin-bottom:6px;">
                    <strong>Reason (1st Preference):</strong>
                    <div id="rs1">‚Äî</div>
                  </div>
                  <div style="font-size:12px;">
                    <strong>Reason (2nd Preference):</strong>
                    <div id="rs2">‚Äî</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ROW 3 ¬∑ LEADERSHIP & CAREER ASPIRATION -->
            <div class="profile-row">
		<!-- LEFT: LEADERSHIP -->
		<div class="profile-col">
		  <div class="box">
<div class="box-header">
  <span class="icon">üß≠</span>
  <span>Role-Specific ‚Äì Leadership</span>
</div>

<!-- A) Leadership style -->
<div style="font-size:12px;margin-bottom:8px;">
  <strong>Future Leadership Style:</strong>
  <div style="font-size:11px;color:#6b7280;margin:2px 0 4px;">
    How the candidate would lead, motivate, and support the team in the target role.
  </div>
  <div id="profile-leadershipStyle">‚Äî</div>
</div>


<!-- B) SBI label -->
<div style="font-size:12px;margin-top:12px;">
  <strong>Candidate‚Äôs Example of Influencing or Motivating Others (SBI Format):</strong>
</div>

<dl class="profile-sbi">
  <div>
    <dt>Situation (S)</dt>
    <dd id="profile-sbiS">‚Äî</dd>
  </div>
  <div>
    <dt>Behavior (B)</dt>
    <dd id="profile-sbiB">‚Äî</dd>
  </div>
  <div>
    <dt>Impact (I)</dt>
    <dd id="profile-sbiI">‚Äî</dd>
  </div>
</dl>


		  </div>
		</div>


              <!-- RIGHT: CAREER ASPIRATION & MOTIVATION -->
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">‚ö°</span>
                    <span>Career Aspiration & Motivation</span>
                  </div>
                  <div class="box-subtitle">
                    Short- to mid-term direction and why the roles matter.
                  </div>
                  <div style="font-size:12px;margin-bottom:4px;">
                    <strong>Career goals (1‚Äì3 years):</strong>
                    <div id="asp-short">‚Äî</div>
                  </div>
                  <div style="font-size:12px;">
                    <strong>Motivation for these roles:</strong>
                    <div id="asp-mid">‚Äî</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ROW 4 ¬∑ SELF-LEADERSHIP & MOBILITY -->
            <div class="profile-row">
              <!-- LEFT: SELF-LEADERSHIP -->
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üå±</span>
                    <span>Optional ‚Äì Self-leadership</span>
                  </div>
                  <div id="profile-selfLeadership" style="font-size:12px;">
                    ‚Äî</div>
                </div>
              </div>

              <!-- RIGHT: Mobility ‚Äì Department Change -->
              <div class="profile-col">
                <div class="box">
                  <div class="box-header">
                    <span class="icon">üöö</span>
                    <span>Mobility ‚Äì Department Change</span>
                  </div>
                  <dl class="dl-grid">
                    <div>
                      <dt>Open to change dept?</dt>
                      <dd id="mob-change">‚Äî</dd>
                    </div>
                  </dl>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Buttons under modal -->
<!-- Buttons under modal -->
<div
  class="btn-row"
  id="profileModalActions"
  data-html2canvas-ignore="true"
  style="margin-top:14px;"
>
  <button type="button" class="btn btn-secondary" id="backToFormBtn">
    ‚¨Ö Back to form
  </button>
  <button type="button" class="btn btn-primary" id="finalSubmitBtn">
    ‚úÖ Confirm & Download PDF + Excel Files
  </button>
</div>

      </div>
    </div>

    <!-- SUCCESS MODAL -->
    <div id="successModal" class="modal">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog">
        <div class="modal-header-row">
          <div class="modal-title">Next Step ‚Äì Complete Your Application</div>
          <button type="button" id="closeSuccessBtn" class="modal-close" aria-label="Close">
            √ó
          </button>
        </div>
        <div class="success-body">
          <p>‚úÖ Your Candidate Profile files are ready for download.</p>
		  <p style="font-size:12px;color:#6b7280;margin-top:6px;">
		    If your browser blocks downloads or asks for permission, please <strong>allow multiple file downloads</strong>, 
			or click <strong>Download PDF</strong> and then <strong>Download Excel</strong> one by one.
			  </p>
			
<div style="display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 6px;">
  <button
    type="button"
    class="btn btn-secondary btn-orange-soft"
    id="downloadPdfBtn"
  >
    ‚¨á Download PDF
  </button>

  <button
    type="button"
    class="btn btn-secondary btn-orange-soft"
    id="downloadExcelBtn"
  >
    ‚¨á Download Excel
  </button>
</div>
			
          <p>Please ensure both files are downloaded before completing the official application form:</p>
          <p>
            üîó <a href="https://forms.office.com/r/E7J5syLsjD" target="_blank" rel="noopener">
              Microsoft Forms ‚Äì Talent Uplift Application
            </a>
          </p>
          <p>
            Or return to the SharePoint portal for full guidelines:<br>
            üîó <a href="https://masterashley.sharepoint.com/sites/Talent_Uplift_Program" target="_blank" rel="noopener">
              Talent Uplift Program ‚Äì SharePoint Site
            </a>
          </p>
          <p>If you need support, please contact:</p>
          <ul>
            <li>Alice Nguyen ‚Äì <a href="mailto:anguyen@ashleyfurniture.com">anguyen@ashleyfurniture.com</a></li>
            <li>Linh Tran ‚Äì <a href="mailto:ltrankhanh@ashleyfurniture.com">ltrankhanh@ashleyfurniture.com</a></li>
          </ul>
        </div>
        <div class="btn-row" style="margin-top:14px;">
          <button type="button" class="btn btn-primary" id="successOkBtn">
            Close
          </button>
        </div>
      </div>
    </div>

  <script>
      function $(id) {
      return document.getElementById(id);
    }

    function escapeHtml(str) {
      if (!str) return "";
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
	
function readAndCompressImage(file, maxSize = 720, quality = 0.82) {
  return new Promise((resolve, reject) => {
    if (!file) return resolve("");
    const reader = new FileReader();
    reader.onerror = reject;
    reader.onload = () => {
      const img = new Image();
      img.onerror = reject;
      img.onload = () => {
        const w = img.width, h = img.height;
        const scale = Math.min(1, maxSize / Math.max(w, h));
        const nw = Math.round(w * scale);
        const nh = Math.round(h * scale);

        const canvas = document.createElement("canvas");
        canvas.width = nw;
        canvas.height = nh;
        const ctx = canvas.getContext("2d");
        
		ctx.imageSmoothingEnabled = true;
		ctx.imageSmoothingQuality = "high";
		ctx.drawImage(img, 0, 0, nw, nh);


        const out = canvas.toDataURL("image/png");
        resolve(out);
      };
      img.src = reader.result;
    };
    reader.readAsDataURL(file);
  });
}

function setPhotoPreview(dataUrl) {
  const img = $("photoPreview");
  if (!img) return;
  if (dataUrl) {
    img.src = dataUrl;
    img.style.display = "block";
  } else {
    img.src = "";
    img.style.display = "none";
  }
}


let toastTimer = null;
let pulseTimer = null;


function showToast(message, type = "success", duration = 2800) {
  const toast = $("microToast");
  const text = $("toastText");
  const icon = $("toastIcon");
  if (!toast || !text || !icon) return;

  const iconMap = {
    success: "‚úÖ",
    lock: "üîí",
    info: "‚ÑπÔ∏è",
    warn: "‚ö†Ô∏è",
    error: "‚ùå"
  };

  icon.textContent = iconMap[type] || "‚ÑπÔ∏è";
  text.textContent = message;

  toast.classList.add("show");
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove("show"), duration);
}

function pulseStep2Link(times = 100, durationMs = 1100) {
  const link = $("msFormLink");
  if (!link) return;

  // N·∫øu ƒëang locked th√¨ tuy·ªát ƒë·ªëi kh√¥ng pulse
  if (link.classList.contains("locked")) return;

  // Clear timer c≈© (n·∫øu tr∆∞·ªõc ƒë√≥ ƒëang pulse)
  if (pulseTimer) clearTimeout(pulseTimer);

  // reset ƒë·ªÉ ch·∫°y l·∫°i ƒë∆∞·ª£c
  link.classList.remove("pulse");
  void link.offsetWidth; // reflow trick
  link.classList.add("pulse");

  // Sau khi pulse xong -> remove pulse
  const total = times * durationMs;
  pulseTimer = setTimeout(() => {
    link.classList.remove("pulse");
    pulseTimer = null;
  }, total + 80);
}



function unlockMsFormLink() {
  const link = $("msFormLink");
  if (!link) return;

  link.classList.remove("locked");
  link.classList.add("unlocked");
  link.setAttribute("aria-disabled", "false");
  link.removeAttribute("tabindex"); // ‚úÖ cho tab l·∫°i
  link.innerHTML = "‚úÖ Step 2 is now unlocked ‚Äì please submit your application";

  try { localStorage.setItem(MSFORM_UNLOCK_KEY, "1"); } catch (e) {}
  pulseStep2Link(100, 1100);
}

function lockMsFormLink() {
  const link = $("msFormLink");
  if (!link) return;

  // ‚úÖ D·ª™NG NH√ÅY NGAY L·∫¨P T·ª®C khi lock
  link.classList.remove("pulse");
  if (pulseTimer) {
    clearTimeout(pulseTimer);
    pulseTimer = null;
  }

  link.classList.remove("unlocked");
  link.classList.add("locked");
  link.setAttribute("aria-disabled", "true");
  link.setAttribute("tabindex", "-1");
  link.innerHTML = "üîí Step 2 ‚Äì Open Microsoft Forms Application";

  try { localStorage.removeItem(MSFORM_UNLOCK_KEY); } catch (e) {}
}


    // ===============================
    // CONFIG ¬∑ CSV & STORAGE
    // ===============================

    const STORAGE_KEY = "talent_uplift_candidate_profile_v1";
	const MSFORM_UNLOCK_KEY = "talent_uplift_msform_unlocked_v1";
    let departments = [];
    let targetRoles = [];
    const rolesMap = {};
    let lastPayload = null;
	// ===== PDF SNAPSHOT CACHE (for instant download) =====
let pdfSnapshotDataUrl = "";     // image of pdfWrapper (JPEG)
let pdfSnapshotKey = "";         // identify snapshot belongs to which payload
let pdfSnapshotReady = false;
let pdfSnapshotBusy = false;

function makeSnapshotKey(payload){
  return (payload?.candidate?.employeeId || "") + "|" + (payload?.meta?.submittedAt || "");
}

async function preparePdfSnapshot(payload){
  if (!payload) return;
  const key = makeSnapshotKey(payload);

  if (pdfSnapshotReady && pdfSnapshotKey === key) return;
  if (pdfSnapshotBusy) return;

  const el = document.getElementById("pdfWrapper");
  const actions = document.getElementById("profileModalActions");
  if (!el) return;

  pdfSnapshotBusy = true;
  pdfSnapshotReady = false;
  pdfSnapshotKey = key;

  const prevDisplay = actions ? actions.style.display : "";
  if (actions) actions.style.display = "none";

  try {
    const canvas = await html2canvas(el, {
      scale: 2,
      useCORS: true,
      backgroundColor: "#ffffff",
      scrollY: 0,
      logging: false
    });

    pdfSnapshotDataUrl = canvas.toDataURL("image/jpeg", 0.92);
    pdfSnapshotReady = true;
  } catch (e) {
    console.warn("preparePdfSnapshot failed:", e);
    pdfSnapshotDataUrl = "";
    pdfSnapshotReady = false;
  } finally {
    if (actions) actions.style.display = prevDisplay || "";
    pdfSnapshotBusy = false;
  }
}

	let photoDataUrl = ""; // uploaded photo as base64 data URL (compressed)
const PHOTO_KEY = "talent_uplift_profile_photo_v1"; // persist photo

	// ===== Download step state (avoid multiple downloads block) =====
const DL_STEP_KEY = "talent_uplift_dl_step_v1"; // persist state
let downloadStep = 0; // 0 = PDF, 1 = Excel, 2 = done

function setFinalBtnLabel() {
  const btn = $("finalSubmitBtn");
  if (!btn) return;
  btn.innerHTML = "‚úÖ Confirm & Download PDF + Excel Files";
}


function persistDownloadStep() {
  try { localStorage.setItem(DL_STEP_KEY, String(downloadStep)); } catch (e) {}
}

function restoreDownloadStep() {
  try {
    const v = localStorage.getItem(DL_STEP_KEY);
    const n = v ? parseInt(v, 10) : 0;

    // ‚úÖ ch·ªâ restore t·ªëi ƒëa PDF
    downloadStep = Number.isFinite(n) ? Math.max(0, Math.min(1, n)) : 0;
  } catch (e) {
    downloadStep = 0;
  }
  setFinalBtnLabel();
}


function resetDownloadStep() {
  downloadStep = 0;
  persistDownloadStep();
  setFinalBtnLabel();
}

function setBtnBusy(isBusy) {
  const btn = $("finalSubmitBtn");
  if (!btn) return;

  btn.disabled = !!isBusy;
  btn.style.opacity = isBusy ? "0.75" : "1";
  btn.style.cursor = isBusy ? "wait" : "pointer";
}

	let positionsByDept = {}; // { deptName: [position1, position2, ...] }




    // ===============================
    // LOAD CSV roles_master.csv
    // ===============================

		async function loadMasterData() {
		  try {
		    const res = await fetch("./assets/roles_master.csv");
		    if (!res.ok) {
		      console.error("Failed to load roles_master.csv");
		      return;
		    }
		    const text = await res.text();
		    const lines = text.trim().split(/\r?\n/);
		    if (lines.length <= 1) return;
		
		    const headerRow = lines[0].split(",").map(h => h.trim().toLowerCase());
		    const idxDept = headerRow.indexOf("department");
		    const idxPos = headerRow.indexOf("position");
		    const idxSucc = headerRow.indexOf("succession");
		
		    if (idxDept === -1 || idxPos === -1 || idxSucc === -1) {
		      console.error("CSV headers must include department, position, succession");
		      return;
		    }
		
		    const deptSet = new Set();
		    const tempRoles = [];
		    const posMap = {}; // t·∫°m l∆∞u positions by dept (Set)
		
		    for (let i = 1; i < lines.length; i++) {
		      const line = lines[i].trim();
		      if (!line) continue;
		      const cols = line.split(",");
		      const dept = (cols[idxDept] || "").trim();
		      const pos = (cols[idxPos] || "").trim();
		      const succ = (cols[idxSucc] || "").trim().toUpperCase();
		
		      if (!dept || !pos) continue;
		
		      deptSet.add(dept);
		
		      // gom t·∫•t c·∫£ position cho Current Role / Position
		      if (!posMap[dept]) posMap[dept] = new Set();
		      posMap[dept].add(pos);
		
		      // ch·ªâ nh·ªØng role succession = TRUE d√πng cho Target Role
		      if (succ === "TRUE") {
		        const id =
		          (dept + "__" + pos)
		            .replace(/\s+/g, "_")
		            .replace(/[^a-zA-Z0-9_]/g, "");
		        const roleObj = {
		          id,
		          title: pos,
		          dept,
		          type: "managerial"
		        };
		        tempRoles.push(roleObj);
		      }
		    }
		
		    departments = Array.from(deptSet).sort();
		    targetRoles = tempRoles;
		    targetRoles.forEach(r => {
		      rolesMap[r.id] = r;
		    });
		
		    // chuy·ªÉn posMap (Set) -> positionsByDept (Array)
		    positionsByDept = {};
		    Object.keys(posMap).forEach(d => {
		      positionsByDept[d] = Array.from(posMap[d]).sort();
		    });
		  } catch (err) {
		    console.error("Error loading master data:", err);
		  }
		}


    // ===============================
    // DOM HELPERS
    // ===============================

    function getSelectedRole(roleSelectId) {
      const select = $(roleSelectId);
      const value = select.value;
      if (!value) return null;
      return rolesMap[value] || null;
    }

    function setDeptLabel(labelId, role) {
      const el = $(labelId);
      if (!el) return;
      if (!role) {
        el.innerHTML = 'Department: <em>--</em>';
      } else {
        el.innerHTML =
          "Department: <strong>" +
          escapeHtml(role.dept) +
          "</strong> ¬∑ <span style='font-size:11px;color:#6b7280'>(Managerial)</span>";
      }
    }


    function getRadioValue(name) {
      const checked = document.querySelector(
        'input[name="' + name + '"]:checked'
      );
      return checked ? checked.value : "";
    }

    // ===============================
    // INIT FORM OPTIONS
    // ===============================

    function initDepartments() {
      const deptSelect = $("currentDept");
      deptSelect.innerHTML = '<option value="">-- Select department --</option>';
      departments.forEach((dept) => {
        const opt = document.createElement("option");
        opt.value = dept;
        opt.textContent = dept;
        deptSelect.appendChild(opt);
      });
    }

    function initRoles() {
      const pref1 = $("pref1Role");
      const pref2 = $("pref2Role");

      pref1.innerHTML = '<option value="">-- Select role --</option>';
      pref2.innerHTML = '<option value="">-- No secondary preference --</option>';

      targetRoles.forEach((role) => {
        const text = role.dept + " ‚Äì " + role.title;

        const opt1 = document.createElement("option");
        opt1.value = role.id;
        opt1.textContent = text;
        pref1.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = role.id;
        opt2.textContent = text;
        pref2.appendChild(opt2);
      });
    }
	
	function refreshCurrentRoleOptions() {
	  const dept = $("currentDept").value;
	  const roleSelect = $("currentRole");
	  roleSelect.innerHTML = "";
	
	  const placeholder = document.createElement("option");
	  placeholder.value = "";
	  placeholder.textContent = dept
	    ? "-- Select role / position --"
	    : "-- Select department first --";
	  roleSelect.appendChild(placeholder);
	
	  if (!dept) return;
	
	  const list = positionsByDept[dept] || [];
	  list.forEach(pos => {
	    const opt = document.createElement("option");
	    opt.value = pos;
	    opt.textContent = pos;
	    roleSelect.appendChild(opt);
	  });
	}


    function updateRoleDependentUI() {
      const currentDept = $("currentDept").value;
      const pref1Role = getSelectedRole("pref1Role");
      const pref2Role = getSelectedRole("pref2Role");

      // update dept labels
      setDeptLabel("pref1DeptLabel", pref1Role);
      setDeptLabel("pref2DeptLabel", pref2Role);

      // Preference 2 reason required only if Pref2 selected
      $("pref2Reason").required = !!pref2Role;
	  if (!pref2Role) $("pref2Reason").value = "";


      // Cross-dept block logic
      let anyCrossDept = false;
      if (currentDept && pref1Role && pref1Role.dept !== currentDept) {
        anyCrossDept = true;
      }
      if (currentDept && pref2Role && pref2Role.dept !== currentDept) {
        anyCrossDept = true;
      }

const crossBlock = $("crossDeptBlock");

if (anyCrossDept) {
  crossBlock.style.display = "block";
  $("crossJustification").required = true;
} else {
  crossBlock.style.display = "none";
  $("crossJustification").required = false;
  $("crossJustification").value = "";
}

    }

    // ===============================
    // ERROR HANDLING
    // ===============================

    function clearAllErrors() {
      document.querySelectorAll(".field-error").forEach((el) => {
        el.textContent = "";
      });
      document
        .querySelectorAll(".has-error")
        .forEach((el) => el.classList.remove("has-error"));
    }

    function setError(fieldId, message) {
      const field = $(fieldId);
      const errEl = $("err-" + fieldId) || (field && field.nextElementSibling);
      if (errEl) errEl.textContent = message;
      if (field) field.classList.add("has-error");
    }

    function scrollToFirstError() {
      const firstErrorField = document.querySelector(".has-error");
      if (firstErrorField) {
        const rect = firstErrorField.getBoundingClientRect();
        const offset = window.scrollY + rect.top - 80;
        window.scrollTo({ top: offset, behavior: "smooth" });
        try {
          firstErrorField.focus({ preventScroll: true });
        } catch (e) {}
      }
    }

    // ===============================
    // LOAD SAMPLE DATA BUTTON
    // ===============================

function findRoleIdByTitle(title) {
  const target = title.trim().toLowerCase();
  // match ch√≠nh x√°c
  let role = targetRoles.find(r => r.title.trim().toLowerCase() === target);
  // n·∫øu kh√¥ng th·∫•y th√¨ match ch·ª©a chu·ªói
  if (!role) {
    role = targetRoles.find(r =>
      r.title.trim().toLowerCase().includes(target)
    );
  }
  return role ? role.id : "";
}


    function loadSampleData() {
      clearAllErrors();

      // BASIC INFO
		$("fullName").value = "Nguyen Van A";
		$("employeeId").value = "0123";
		$("workEmail").value = "nguyen.van.a@ashleyfurniture.com";
		$("currentDept").value = "Engineering";
		refreshCurrentRoleOptions();
		$("currentRole").value = "Process Engineer";
      // PREFERENCES
      $("pref1Role").value = findRoleIdByTitle("Engineering Project Manager");
      $("pref1Reason").value =
        "I aim to grow into a project leadership role where I can coordinate cross-functional work, manage timelines, and deliver impactful engineering outcomes for both factory and commercial teams.";

      $("pref2Role").value = findRoleIdByTitle("Team Leader of Solutions Development");
      $("pref2Reason").value =
        "I am also interested in Strategy Execution because it connects data, projects and business priorities. This role would allow me to work across departments and drive initiatives that improve execution discipline.";

      $("crossJustification").value =
        "My current role in Engineering already requires frequent collaboration with Strategy Execution on project timelines, risk tracking and improvement initiatives, so I have relevant exposure and interest in this area.";

      // ROLE-SPECIFIC
      $("leadershipStyle").value =
        "I try to lead with clarity, trust and support. I focus on setting clear expectations, giving regular feedback, and creating space for team members to share ideas and take ownership of their tasks.";
      $("sbiSituation").value =
        "Our project team was facing delays due to conflicting priorities and unclear handover between functions.";
      $("sbiBehavior").value =
        "I organised a short alignment session, clarified milestones, reassigned some tasks based on strengths, and set up weekly check-ins to track risk and support team members.";
      $("sbiImpact").value =
        "The team caught up on the timeline, reported higher clarity and confidence, and stakeholders recognised the team for the improved coordination.";

      // CAREER & MOTIVATION
      $("careerGoals").value =
        "In the next 1‚Äì3 years, I want to strengthen my project management capability, cross-functional collaboration and leadership skills so that I can handle larger regional projects and lead a small team.";
      $("motivation").value =
        "I want to be considered for these roles because I believe I can contribute more by coordinating people, processes and data, not only by doing individual engineering tasks. I am committed to long-term development with Ashley and ready to invest effort to grow into these roles.";

      // MOBILITY
      document
        .querySelectorAll('input[name="changeDept"]')
        .forEach((x) => (x.checked = false));
      document.querySelector(
        'input[name="changeDept"][value="maybe"]'
      ).checked = true;

      // OPTIONAL SELF-LEADERSHIP
      $("selfLeadership").value =
        "I created a 3-month self-learning plan on data visualisation, studied after working hours, and then built dashboards that help my manager track defect trends and make faster decisions.";

      // CONSENTS
      $("consentDevelopment").checked = true;
      $("consentSharing").checked = true;
      $("consentAccuracy").checked = true;

      updateRoleDependentUI();
      saveFormToLocalStorage();
    }

    // ===============================
    // VALIDATION
    // ===============================

    function validateForm() {
      clearAllErrors();
      let hasError = false;

      const fullName = $("fullName").value.trim();
      const employeeId = $("employeeId").value.trim();
      const workEmail = $("workEmail").value.trim();
      const currentDept = $("currentDept").value;
      const currentRole = $("currentRole").value.trim();

      if (!fullName) {
        setError("fullName", "Please enter your Full Name.");
        hasError = true;
      }

      const numericEmpId = employeeId.replace(/\D/g, "");
      if (!numericEmpId) {
        setError("employeeId", "Please enter your Employee ID (4 digits).");
        hasError = true;
      } else if (numericEmpId.length !== 4) {
        setError(
          "employeeId",
          "Employee ID must be 4 digits. The system will auto-format if needed."
        );
        hasError = true;
      }

      if (!workEmail) {
        setError("workEmail", "Please enter your Work Email.");
        hasError = true;
      } else {
        const emailPattern = /^[^\s@]+@ashleyfurniture\.com$/i;
        if (!emailPattern.test(workEmail)) {
          setError(
            "workEmail",
            "Please use your work email with '@ashleyfurniture.com'."
          );
          hasError = true;
        }
      }

      if (!currentDept) {
        setError("currentDept", "Please select your current Department.");
        hasError = true;
      }
      if (!currentRole) {
        setError("currentRole", "Please select your Current Role / Position.");
        hasError = true;
      }

      const pref1Role = getSelectedRole("pref1Role");
      const pref2Role = getSelectedRole("pref2Role");

      if (!pref1Role) {
        setError("pref1Role", "Please select your Preference 1 role.");
        hasError = true;
      }

      const pref1Reason = $("pref1Reason").value.trim();
      if (!pref1Reason || pref1Reason.length < 30) {
        setError(
          "pref1Reason",
          "Please provide a meaningful reason for Preference 1 (at least 2‚Äì3 lines)."
        );
        hasError = true;
      }

      const pref2Reason = $("pref2Reason").value.trim();
      if (pref2Role && (!pref2Reason || pref2Reason.length < 30)) {
        setError(
          "pref2Reason",
          "Please provide a meaningful reason for Preference 2 (at least 2‚Äì3 lines)."
        );
        hasError = true;
      }

      // Preference 2 must be different
      if (pref1Role && pref2Role && pref1Role.id === pref2Role.id) {
        setError(
          "pref2Role",
          "Preference 2 must be different from Preference 1."
        );
        hasError = true;
      }

      // At least 1 preference must be within current department
      if (currentDept && pref1Role) {
        const pref1InDept = pref1Role.dept === currentDept;
        const pref2InDept = pref2Role && pref2Role.dept === currentDept;
        if (!pref1InDept && !pref2InDept) {
          setError(
            "pref1Role",
            "At least one of your preferences must be within your current department."
          );
          setError(
            "pref2Role",
            "At least one of your preferences must be within your current department."
          );
          hasError = true;
        }
      }

      // Cross-dept justification if needed
      const crossBlockVisible =
        $("crossDeptBlock").style.display !== "none";
      if (crossBlockVisible) {
        const crossText = $("crossJustification").value.trim();
        if (!crossText || crossText.length < 20) {
          setError(
            "crossJustification",
            "Please explain your reasoning for applying to a role in another department."
          );
          hasError = true;
        }
      }

      // Leadership & SBI
      const leadershipStyle = $("leadershipStyle").value.trim();
      if (!leadershipStyle || leadershipStyle.length < 30) {
        setError(
          "leadershipStyle",
          "Please describe your future leadership style (at least a few lines)."
        );
        hasError = true;
      }

      const s = $("sbiSituation").value.trim();
      const b = $("sbiBehavior").value.trim();
      const i = $("sbiImpact").value.trim();
      if (!s || s.length < 20) {
        setError(
          "sbiSituation",
          "Please describe the situation (at least a few lines)."
        );
        hasError = true;
      }
      if (!b || b.length < 20) {
        setError(
          "sbiBehavior",
          "Please describe your actions (Behavior) in this example."
        );
        hasError = true;
      }
      if (!i || i.length < 20) {
        setError(
          "sbiImpact",
          "Please describe the impact and result of your actions."
        );
        hasError = true;
      }

      // Career & motivation
      const careerGoals = $("careerGoals").value.trim();
      const motivation = $("motivation").value.trim();

      if (!careerGoals || careerGoals.length < 30) {
        setError(
          "careerGoals",
          "Please describe your short- to mid-term career goals (at least a few lines)."
        );
        hasError = true;
      }
      if (!motivation || motivation.length < 30) {
        setError(
          "motivation",
          "Please explain why you want to be considered for these role(s) (at least a few lines)."
        );
        hasError = true;
      }

      // Mobility
const changeDept = getRadioValue("changeDept");
if (!changeDept) {
  $("err-changeDept").textContent =
    "Please indicate your willingness to change department.";
  $("changeDeptWrap").classList.add("has-error");
  hasError = true;
} else {
  $("err-changeDept").textContent = "";
  $("changeDeptWrap").classList.remove("has-error");
}

      // Consents
      let consErr = "";
      if (!$("consentDevelopment").checked) {
        consErr =
          "Please confirm your understanding about development vs promotion.";
      }
      if (!$("consentSharing").checked) {
        consErr =
          (consErr ? consErr + " " : "") +
          "Please confirm your understanding that your profile may be shared with relevant stakeholders.";
      }
      if (!$("consentAccuracy").checked) {
        consErr =
          (consErr ? consErr + " " : "") +
          "Please confirm that your information is accurate to the best of your knowledge.";
      }
      if (consErr) {
        $("err-consents").textContent = consErr;
        hasError = true;
      }

      return !hasError;
    }

    // ===============================
    // BUILD PAYLOAD FROM FORM
    // ===============================

    function buildPayloadFromForm() {
      const pref1Role = getSelectedRole("pref1Role");
      const pref2Role = getSelectedRole("pref2Role");

      const payload = {
        meta: {
          submittedAt: new Date().toISOString()
        },
        candidate: {
          fullName: $("fullName").value.trim(),
          employeeId: $("employeeId").value.trim(),
          workEmail: $("workEmail").value.trim(),
          currentDept: $("currentDept").value,
          currentRole: $("currentRole").value.trim(),
		  photoDataUrl: photoDataUrl || null
        },
        preferences: {
          preference1: pref1Role
            ? {
                roleId: pref1Role.id,
                roleTitle: pref1Role.title,
                department: pref1Role.dept,
                type: pref1Role.type,
                reason: $("pref1Reason").value.trim()
              }
            : null,
          preference2: pref2Role
            ? {
                roleId: pref2Role.id,
                roleTitle: pref2Role.title,
                department: pref2Role.dept,
                type: pref2Role.type,
                reason: $("pref2Reason").value.trim()
              }
            : null,
          crossDepartmentJustification:
            $("crossJustification").value.trim() || null
        },
        roleSpecific: {
          leadershipStyle: $("leadershipStyle").value.trim(),
          sbiSituation: $("sbiSituation").value.trim(),
          sbiBehavior: $("sbiBehavior").value.trim(),
          sbiImpact: $("sbiImpact").value.trim()
        },
        careerAndMobility: {
          careerGoals: $("careerGoals").value.trim(),
          motivation: $("motivation").value.trim(),
          willingChangeDept: getRadioValue("changeDept"),
          selfLeadershipExample:
            $("selfLeadership").value.trim() || null
        },

        consents: {
          developmentVsPromotion: $("consentDevelopment").checked,
          sharingWithHoDsAndHR: $("consentSharing").checked,
          accuracyConfirmed: $("consentAccuracy").checked
        }
      };

      return payload;
    }

function showJsonPreview(payload) {
  const el = $("jsonOutput");
  if (!el) return;
  el.textContent = JSON.stringify(payload, null, 2);
}

    // ===============================
    // PROFILE CARD POPULATION
    // ===============================

    function humanizeChangeDept(val) {
      if (val === "yes") return "Yes";
      if (val === "maybe") return "Maybe / depends on role";
      if (val === "no") return "No";
      return "‚Äî";
    }

    function fillProfileCard(payload) {
      // header ID
		$("pdfTagEmployeeId").textContent =
		  "ID: " + (payload.candidate.employeeId || "‚Äî");


      // Basic info
      $("bi-name").innerText = payload.candidate.fullName || "‚Äî";
      $("bi-dept").innerText = payload.candidate.currentDept || "‚Äî";
      $("bi-role").innerText = payload.candidate.currentRole || "‚Äî";
	    // Photo in PDF Basic Info
const p = payload.candidate.photoDataUrl || "";
const photoBox = $("bi-photo");
const photoImg = $("bi-photo-img");
const empty = $("bi-photo-empty");

if (photoBox && empty && photoImg) {
  if (p) {
    photoImg.src = p;
    photoBox.style.display = "block";
    empty.style.display = "none";
  } else {
    photoImg.src = "";
    photoBox.style.display = "none";
    empty.style.display = "flex";
  }
}




      // Preferences
      const p1 = payload.preferences.preference1;
      const p2 = payload.preferences.preference2;

      if (p1) {
        $("pref1").innerHTML =
          escapeHtml(p1.roleTitle) +
          ' <span class="dept-tag">(' +
          escapeHtml(p1.department) +
          ")</span>";
      } else {
        $("pref1").innerText = "‚Äî";
      }

      if (p2) {
        $("pref2").innerHTML =
          escapeHtml(p2.roleTitle) +
          ' <span class="dept-tag">(' +
          escapeHtml(p2.department) +
          ")</span>";
      } else {
        $("pref2").innerText = "‚Äî";
      }

      // Cross-dept badge for 2nd preference
const currentDept = payload.candidate.currentDept;
const anyCross =
  (p1 && currentDept && p1.department !== currentDept) ||
  (p2 && currentDept && p2.department !== currentDept);

$("crossNotice").style.display = anyCross ? "inline-block" : "none";
// Cross-dept justification inside PDF Roles box
const cj = payload.preferences.crossDepartmentJustification || "";
const wrap = $("pdfCrossJustWrap");
const txt = $("pdfCrossJustText");

if (wrap && txt) {
  if (anyCross && cj.trim()) {
    wrap.style.display = "block";
    txt.innerText = cj.trim();
  } else {
    wrap.style.display = "none";
    txt.innerText = "‚Äî";
  }
}



      // Reasons
      $("rs1").innerText = (p1 && p1.reason) || "‚Äî";
      $("rs2").innerText = (p2 && p2.reason) || "‚Äî";

      // Mobility
      $("mob-change").innerText = humanizeChangeDept(
        payload.careerAndMobility.willingChangeDept
      );

      // Aspiration
      $("asp-short").innerText =
        payload.careerAndMobility.careerGoals || "‚Äî";
      $("asp-mid").innerText =
        payload.careerAndMobility.motivation || "‚Äî";

      // Leadership & SBI
      $("profile-leadershipStyle").innerText =
        payload.roleSpecific.leadershipStyle || "‚Äî";
      $("profile-sbiS").innerText =
        payload.roleSpecific.sbiSituation || "‚Äî";
      $("profile-sbiB").innerText =
        payload.roleSpecific.sbiBehavior || "‚Äî";
      $("profile-sbiI").innerText =
        payload.roleSpecific.sbiImpact || "‚Äî";

      // Optional self-leadership
      $("profile-selfLeadership").innerText =
        payload.careerAndMobility.selfLeadershipExample || "‚Äî";
    }

    // ===============================
    // FILE NAMING
    // ===============================

    function getFileBaseName(payload) {
      const rawId = payload.candidate.employeeId || "candidate";
      const safeId = rawId.replace(/[^a-zA-Z0-9_-]/g, "_");
      const dt = new Date();
      const yyyy = dt.getFullYear();
      const mm = String(dt.getMonth() + 1).padStart(2, "0");
      const dd = String(dt.getDate()).padStart(2, "0");
      return `candidate_profile_${safeId}_${yyyy}${mm}${dd}`;
    }

    // ===============================
    // EXCEL & PDF DOWNLOAD
    // ===============================

    function downloadExcel(payload) {
      const baseName = getFileBaseName(payload);

      const p1 = payload.preferences.preference1 || {};
      const p2 = payload.preferences.preference2 || {};

      const data = [
        [
          "Full Name",
          "Employee ID",
          "Work Email",
          "Current Department",
          "Current Role",
          "Pref1 Role Title",
          "Pref1 Department",
          "Pref1 Reason",
          "Pref2 Role Title",
          "Pref2 Department",
          "Pref2 Reason",
          "Cross-dept Justification",
          "Leadership Style",
          "SBI ‚Äì Situation",
          "SBI ‚Äì Behavior",
          "SBI ‚Äì Impact",
          "Career Goals (1‚Äì3 years)",
          "Motivation for Roles",
          "Willingness to Change Dept",
          "Self-leadership Example",
		  "Has Photo",
          "Submitted At"
        ],
        [
          payload.candidate.fullName || "",
          payload.candidate.employeeId || "",
          payload.candidate.workEmail || "",
          payload.candidate.currentDept || "",
          payload.candidate.currentRole || "",
          p1.roleTitle || "",
          p1.department || "",
          p1.reason || "",
          p2.roleTitle || "",
          p2.department || "",
          p2.reason || "",
          payload.preferences.crossDepartmentJustification || "",
          payload.roleSpecific.leadershipStyle || "",
          payload.roleSpecific.sbiSituation || "",
          payload.roleSpecific.sbiBehavior || "",
          payload.roleSpecific.sbiImpact || "",
          payload.careerAndMobility.careerGoals || "",
          payload.careerAndMobility.motivation || "",
          humanizeChangeDept(payload.careerAndMobility.willingChangeDept),
          payload.careerAndMobility.selfLeadershipExample || "",
		  (payload.candidate.photoDataUrl ? "Yes" : "No"),
          payload.meta.submittedAt || ""
        ]
      ];

      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Candidate_Profile");
      XLSX.writeFile(wb, baseName + ".xlsx");
    }

    function downloadProfilePdf(payload) {
  const baseName = getFileBaseName(payload);

  // ‚úÖ If snapshot ready for this payload => INSTANT download
  const key = makeSnapshotKey(payload);
  if (pdfSnapshotReady && pdfSnapshotKey === key && pdfSnapshotDataUrl) {
    const { jsPDF } = window.jspdf || {};
    if (!jsPDF) {
      console.warn("jsPDF not found, fallback to html2pdf");
    } else {
      const pdf = new jsPDF("p", "mm", "a4");

      // A4 size in mm
      const pageW = 210;
      const pageH = 297;

      // image props to fit full page while keeping aspect
      const imgProps = pdf.getImageProperties(pdfSnapshotDataUrl);
      const imgW = pageW;
      const imgH = (imgProps.height * imgW) / imgProps.width;

      // center vertically if shorter than page (or just start at top)
      const y = 0;
      pdf.addImage(pdfSnapshotDataUrl, "JPEG", 0, y, imgW, imgH, undefined, "FAST");
      pdf.save(baseName + ".pdf");
      return Promise.resolve();
    }
  }

  // ‚úÖ Fallback (slower): html2pdf direct render
  const element = document.getElementById("pdfWrapper");
  const actions = document.getElementById("profileModalActions");

  const prevDisplay = actions ? actions.style.display : "";
  if (actions) actions.style.display = "none";

  const opt = {
    margin: [10, 10, 10, 10],
    filename: baseName + ".pdf",
    image: { type: "jpeg", quality: 0.92 },
    html2canvas: { scale: 2, useCORS: true, scrollY: 0, logging: false },
    jsPDF: { unit: "mm", format: "a4", orientation: "portrait", compress: true }
  };

  return html2pdf()
    .set(opt)
    .from(element)
    .save()
    .finally(() => {
      if (actions) actions.style.display = prevDisplay || "";
    });
}

    // ===============================
    // LOCAL STORAGE
    // ===============================

    function saveFormToLocalStorage() {
      const data = {
        fullName: $("fullName").value,
        employeeId: $("employeeId").value,
        workEmail: $("workEmail").value,
        currentDept: $("currentDept").value,
        currentRole: $("currentRole").value,
        pref1Role: $("pref1Role").value,
        pref1Reason: $("pref1Reason").value,
        pref2Role: $("pref2Role").value,
        pref2Reason: $("pref2Reason").value,
        crossJustification: $("crossJustification").value,
        leadershipStyle: $("leadershipStyle").value,
        sbiSituation: $("sbiSituation").value,
        sbiBehavior: $("sbiBehavior").value,
        sbiImpact: $("sbiImpact").value,
        careerGoals: $("careerGoals").value,
        motivation: $("motivation").value,
        selfLeadership: $("selfLeadership").value,
        changeDept: getRadioValue("changeDept"),
        consentDevelopment: $("consentDevelopment").checked,
        consentSharing: $("consentSharing").checked,
        consentAccuracy: $("consentAccuracy").checked,
photoDataUrl: photoDataUrl || ""

      };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.warn("LocalStorage save error:", e);
      }
    }

    function restoreFormFromLocalStorage() {
      let raw = null;
      try {
        raw = localStorage.getItem(STORAGE_KEY);
      } catch (e) {
        console.warn("LocalStorage read error:", e);
      }
      if (!raw) return;
      let data;
      try {
        data = JSON.parse(raw);
      } catch (e) {
        return;
      }
      if (!data) return;

      $("fullName").value = data.fullName || "";
	  $("employeeId").value = data.employeeId || "";
	  $("workEmail").value = data.workEmail || "";
	  $("currentDept").value = data.currentDept || "";
	  refreshCurrentRoleOptions();
	  $("currentRole").value = data.currentRole || "";
      $("pref1Role").value = data.pref1Role || "";
      $("pref1Reason").value = data.pref1Reason || "";
      $("pref2Role").value = data.pref2Role || "";
      $("pref2Reason").value = data.pref2Reason || "";
      $("crossJustification").value = data.crossJustification || "";
      $("leadershipStyle").value = data.leadershipStyle || "";
      $("sbiSituation").value = data.sbiSituation || "";
      $("sbiBehavior").value = data.sbiBehavior || "";
      $("sbiImpact").value = data.sbiImpact || "";
      $("careerGoals").value = data.careerGoals || "";
      $("motivation").value = data.motivation || "";
      $("selfLeadership").value = data.selfLeadership || "";

      // Radio changeDept
      document
        .querySelectorAll('input[name="changeDept"]')
        .forEach((el) => {
          el.checked = (el.value === data.changeDept);
        });

      $("consentDevelopment").checked = !!data.consentDevelopment;
      $("consentSharing").checked = !!data.consentSharing;
      $("consentAccuracy").checked = !!data.consentAccuracy;
photoDataUrl = data.photoDataUrl || "";
setPhotoPreview(photoDataUrl);
try {
  if (photoDataUrl) localStorage.setItem(PHOTO_KEY, photoDataUrl);
  else localStorage.removeItem(PHOTO_KEY);
} catch(e) {}

      updateRoleDependentUI();
    }

    function clearLocalStorageData() {
      try {
        localStorage.removeItem(STORAGE_KEY);
      } catch (e) {
        console.warn("LocalStorage clear error:", e);
      }
    }

    // ===============================
    // MAIN INIT
    // ===============================

    document.addEventListener("DOMContentLoaded", async function () {
      // Load CSV-based data
      await loadMasterData();
	  initDepartments();
	  initRoles();
	  refreshCurrentRoleOptions();
	  restoreFormFromLocalStorage();
	  updateRoleDependentUI();
	  restoreDownloadStep();
	  // Restore photo (optional)
try {
  const saved = localStorage.getItem(PHOTO_KEY);
  if (saved && !photoDataUrl) {
    photoDataUrl = saved;
    setPhotoPreview(photoDataUrl);
  }
} catch (e) {}

// Photo upload handler
$("profilePhoto")?.addEventListener("change", async function () {
  const file = this.files && this.files[0];

  const err = $("err-profilePhoto");
  if (err) err.textContent = "";

  if (!file) {
    photoDataUrl = "";
    setPhotoPreview("");
    try { localStorage.removeItem(PHOTO_KEY); } catch(e) {}
    saveFormToLocalStorage();
    return;
  }

  if (file.size > 2 * 1024 * 1024) {
    if (err) err.textContent = "Please upload an image under 2MB.";
    this.value = "";
    photoDataUrl = "";
    setPhotoPreview("");
    try { localStorage.removeItem(PHOTO_KEY); } catch(e) {}
    return;
  }

  try {
    photoDataUrl = await readAndCompressImage(file, 900, 0.92);
    setPhotoPreview(photoDataUrl);
    try { localStorage.setItem(PHOTO_KEY, photoDataUrl); } catch(e) {}
    saveFormToLocalStorage();
  } catch (e) {
    if (err) err.textContent = "Could not read the image. Please try another file.";
    this.value = "";
    photoDataUrl = "";
    setPhotoPreview("");
    try { localStorage.removeItem(PHOTO_KEY); } catch(e) {}
  }
});


	  
	  // ‚úÖ CH√àN ƒêO·∫†N ‚ÄúCLICK LOGO LOAD SAMPLE‚Äù NGAY ·ªû ƒê√ÇY
const secretLogo = $("secretSampleLogo");
if (secretLogo) {
  let clickCount = 0;
  let clickTimer = null;

  const RESET_MS = 900; // m·ªói click ph·∫£i c√°ch nhau <= 900ms

  secretLogo.addEventListener("click", function () {
    clickCount++;

    // reset timer m·ªói l·∫ßn click
    if (clickTimer) clearTimeout(clickTimer);
    clickTimer = setTimeout(() => {
      clickCount = 0;
      clickTimer = null;
    }, RESET_MS);

    // ƒë·ªß 5 click trong th·ªùi gian y√™u c·∫ßu -> load sample
    if (clickCount === 5) {
      clickCount = 0;
      if (clickTimer) clearTimeout(clickTimer);
      clickTimer = null;

      loadSampleData();
      // kh√¥ng show toast / kh√¥ng hint
    }
  });
}

  try {
    if (localStorage.getItem(MSFORM_UNLOCK_KEY) === "1") unlockMsFormLink();
    else lockMsFormLink();
  } catch (e) {
    lockMsFormLink();
  }

      // Auto-format Employee ID (digits only, pad to 4 on blur)
      $("employeeId").addEventListener("input", function () {
        this.value = this.value.replace(/\D/g, "");
        saveFormToLocalStorage();
      });
      $("employeeId").addEventListener("blur", function () {
        let v = this.value.replace(/\D/g, "");
        if (!v) return;
        if (v.length > 4) v = v.slice(-4);
        this.value = v.padStart(4, "0");
        saveFormToLocalStorage();
      });

      // change/blur listeners to update UI & inline validation
		$("currentDept").addEventListener("change", function () {
		  refreshCurrentRoleOptions();
		  updateRoleDependentUI();
		  saveFormToLocalStorage();
		});
		
		$("currentRole").addEventListener("focus", function () {
		  if (!$("currentDept").value) {
		    alert("Please select your Current Department first.");
		    $("currentDept").focus();
		  }
		});
		$("currentRole").addEventListener("change", function () {
  saveFormToLocalStorage();
});


		
      $("pref1Role").addEventListener("change", function () {
        updateRoleDependentUI();
        saveFormToLocalStorage();
      });
      $("pref2Role").addEventListener("change", function () {
        updateRoleDependentUI();
        saveFormToLocalStorage();
      });

      const validateOnBlurIds = [
        "fullName",
        "employeeId",
        "workEmail",
        "currentRole",
        "pref1Reason",
        "pref2Reason",
        "crossJustification",
        "leadershipStyle",
        "sbiSituation",
        "sbiBehavior",
        "sbiImpact",
        "careerGoals",
        "motivation"
      ];
      validateOnBlurIds.forEach((id) => {
        const el = $(id);
        if (el) {
          el.addEventListener("blur", () => {
            validateForm();
            saveFormToLocalStorage();
          });
        }
      });

      // Form-wide input/change for saving
      $("applicationForm").addEventListener("input", saveFormToLocalStorage);
      $("applicationForm").addEventListener("change", saveFormToLocalStorage);

      // Form submit
      $("applicationForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const valid = validateForm();

        if (valid) {
          const payload = buildPayloadFromForm();
          lastPayload = payload;

          showJsonPreview(payload);
          fillProfileCard(payload);

          $("successMessage").style.display = "block";

          // open modal
          $("profileModal").classList.add("show");
		  resetDownloadStep(); // NEW: always start from PDF when opening preview
		  setTimeout(() => preparePdfSnapshot(payload), 60);
        } else {
          $("successMessage").style.display = "none";
          scrollToFirstError();
        }
      });

      // Reset
      $("btnReset").addEventListener("click", function () {
        clearAllErrors();
        $("jsonOutput").textContent = "Waiting for submission‚Ä¶";
        $("successMessage").style.display = "none";
        lastPayload = null;
        clearLocalStorageData();
		$("applicationForm").reset();
		photoDataUrl = "";
setPhotoPreview("");
try { localStorage.removeItem(PHOTO_KEY); } catch(e) {}
if ($("profilePhoto")) $("profilePhoto").value = "";

refreshCurrentRoleOptions();
updateRoleDependentUI();
        setTimeout(updateRoleDependentUI, 10);
		 resetDownloadStep();
		lockMsFormLink();
showToast("Step 2 link is locked again. Generate & download to unlock.", "lock", 2400);
      });

      // Modal controls
$("closeModalBtn").addEventListener("click", function () {
  $("profileModal").classList.remove("show");
  window.scrollTo({ top: 0, behavior: "smooth" });
});

$("closeSuccessBtn").addEventListener("click", function () {
  $("successModal").classList.remove("show");
  window.scrollTo({ top: 0, behavior: "smooth" });
});

$("successOkBtn").addEventListener("click", function () {
  $("successModal").classList.remove("show");
  window.scrollTo({ top: 0, behavior: "smooth" });
});

// Re-download buttons inside Success Modal
$("downloadPdfBtn")?.addEventListener("click", function () {
  if (!lastPayload) return;

  downloadProfilePdf(lastPayload);

  if (downloadStep < 1) {
    downloadStep = 1;
    persistDownloadStep();
    setFinalBtnLabel();
  }
});


$("downloadExcelBtn")?.addEventListener("click", function () {
  if (!lastPayload) return;

  downloadExcel(lastPayload);

  downloadStep = 2;
  persistDownloadStep();
  setFinalBtnLabel();
});



$("finalSubmitBtn").addEventListener("click", function () {
  if (!lastPayload) {
    alert("Please generate the Candidate Profile first.");
    return;
  }

  // prevent double-click while generating/download starting
  setBtnBusy(true);

  const finalPayload = lastPayload;
  showJsonPreview(finalPayload);

// Step 0: Auto-download PDF, then attempt Excel
if (downloadStep === 0) {
  try {
    // 1Ô∏è‚É£ PDF lu√¥n t·∫£i tr∆∞·ªõc
    downloadProfilePdf(finalPayload);
    downloadStep = 1;
    persistDownloadStep();
    setFinalBtnLabel();

    showToast("PDF download started. Preparing Excel file...", "info", 2200);

    // 2Ô∏è‚É£ Delay nh·∫π r·ªìi m·ªõi trigger Excel
setTimeout(() => {
  try {
    downloadExcel(finalPayload); // Excel may be blocked
  } catch (e) {
    console.warn("Excel auto-download may be blocked");
  } finally {
    // ‚ùó KH√îNG set downloadStep = 2 ·ªü ƒë√¢y
    unlockMsFormLink();
    $("successModal").classList.add("show");
  }
}, 650);


  } finally {
    setTimeout(() => setBtnBusy(false), 700);
  }
  return;
}


  // Step 2: Already done
  setBtnBusy(false);
  $("successModal").classList.add("show");

});

	
	// Close modal when clicking backdrop
document.querySelectorAll(".modal-backdrop").forEach((b) => {
  b.addEventListener("click", () => {
    const wasProfileOpen = $("profileModal").classList.contains("show");
    const wasSuccessOpen = $("successModal").classList.contains("show");

    $("profileModal").classList.remove("show");
    $("successModal").classList.remove("show");

    // n·∫øu ƒë√≥ng modal ki·ªÉu "back to form" (click ra ngo√†i) -> cu·ªôn l√™n ƒë·∫ßu
    if (wasProfileOpen || wasSuccessOpen) {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  });
});


// Close modal on ESC key (and scroll to top)
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    const wasProfileOpen = $("profileModal").classList.contains("show");
    const wasSuccessOpen = $("successModal").classList.contains("show");

    $("profileModal").classList.remove("show");
    $("successModal").classList.remove("show");

    // n·∫øu ESC d√πng ƒë·ªÉ quay l·∫°i form -> scroll l√™n ƒë·∫ßu
    if (wasProfileOpen || wasSuccessOpen) {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }
});
// back to form event listener
$("backToFormBtn").addEventListener("click", function () {
  $("profileModal").classList.remove("show");
  window.scrollTo({ top: 0, behavior: "smooth" });
});

$("msFormLink").addEventListener("click", function () {
  // ch·ªâ x·ª≠ l√Ω khi unlocked
  if (this.classList.contains("unlocked")) {
    this.classList.remove("pulse"); // ng·ª´ng nh·∫•p nh√°y
  }
});

}); // end DOMContentLoaded


  </script>
  <!-- MICRO TOAST -->
<div id="microToast" class="toast" role="status" aria-live="polite">
  <div class="toast-inner">
    <span id="toastIcon" class="toast-icon">‚úÖ</span>
    <span id="toastText">Step 2 link is now unlocked.</span>
  </div>
  </div>
  <!-- Hidden debug output (kept for internal use, not visible to candidates) -->
<pre id="jsonOutput" style="display:none;"></pre>
</body>
</html>
